<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification Portal | OSD</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --theme-purple: #6a1b9a;
            --theme-bg: #f4f4f4;
            --text-color: #333;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(to bottom, #7b1fa2 40%, #f5f5f5 40%); /* Top Purple, Bottom Gray */
            min-height: 100vh;
            margin: 0; padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 100px; /* Space for top logo overlap */
        }

        /* --- MAIN CARD --- */
        .card-container {
            background: white;
            width: 90%;
            max-width: 850px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: relative;
            margin-bottom: 50px;
        }

        /* --- BIG FLOATING LOGO (ScreenShot Style) --- */
        .floating-logo-container {
            position: absolute;
            top: 0; 
            left: 50%;
            transform: translate(-50%, -50%); /* Center perfectly on the top edge */
            width: 160px; /* BADA SIZE */
            height: 160px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
            border: 4px solid white; /* Optional border */
        }

        .floating-logo-container img {
            width: 250px; /* Image inside circle */
            height: auto;
        }

        /* --- TABS SECTION --- */
        .tabs-header {
            display: flex;
            width: 100%;
            height: 60px;
            overflow: hidden;
            border-radius: 8px 8px 0 0;
        }

        .tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.3s;
        }
         /* Inactive Tab Style */
        .tab-inactive {
            background-color: white;
            color: red;
            border-bottom: 1px solid #ddd;
        }
        .tab-inactive:hover {
            background-color: #e0e0e0;
        }

        /* Active Tab Style (Like Screenshot Right Side) */
        .tab-active {
            background-color: green;
            color: white
        }

        /* --- FORM CONTENT --- */
        .tab-content {
            padding: 40px;
            position: relative;
            /* Background Watermark Image */
            background-image: url('https://raw.githubusercontent.com/Orbital-Skills/osi.com/main/LOGO.png'); 
            background-repeat: no-repeat;
            background-position: center;
            background-size: 500px;
        }
        
        /* Watermark Overlay Hack to make it faded */
        .tab-content::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.92); /* Covers the logo to make it faint */
            z-index: 1;
        }

        /* Ensures content sits above the watermark */
        .form-area {
            position: relative;
            z-index: 2;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }

        /* --- INPUT STYLES --- */
        .input-group { margin-bottom: 20px; }
        
        .input-group label {
            display: block;
            color: #444;
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .input-group label span { color: #d32f2f; } /* Red Asterisk */

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            font-size: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fdfdfd;
            box-sizing: border-box; /* Fixes padding width issue */
            transition: 0.2s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--theme-purple);
            box-shadow: 0 0 0 3px rgba(106, 27, 154, 0.1);
        }

        /* --- GRID SYSTEM --- */
        .row { display: flex; gap: 20px; }
        .col { flex: 1; }
        
        @media(max-width: 600px) {
            .row { flex-direction: column; gap: 0; }
        }

        /* --- BUTTON --- */
        .verify-btn {
            background-color: #7b1fa2; /* Slightly different purple for button */
            background: linear-gradient(to right, #7b1fa2, #9c27b0);
            color: white;
            border: none;
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: 800;
            text-transform: uppercase;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            margin-top: 10px;
        }
        .verify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        /* --- RESULT TABLE --- */
        .result-box {
            display: none; margin-top: 30px; border-top: 2px dashed #ddd; padding-top: 20px;
            text-align: center;
        }
        .success-badge {
            background: #e8f5e9; color: #2e7d32; padding: 10px; border-radius: 4px;
            font-weight: bold; margin-bottom: 20px; display: inline-block; width: 100%; box-sizing: border-box;
        }
        .data-table {
            width: 100%; border-collapse: collapse; text-align: left;
        }
        .data-table td { padding: 10px; border-bottom: 1px solid #eee; }
        .data-lbl { font-weight: 600; color: #555; width: 40%; }
        .data-val { font-weight: 700; color: #000; }

        @keyframes fadeIn { from{opacity:0; transform: translateY(5px);} to{opacity:1; transform: translateY(0);} }

        /* Loader */
        .loader { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 100;
            color: white; text-align: center; padding-top: 40vh; font-size: 20px;
        }
        .error-msg {
            background: #ffebee; color: #c62828; padding: 12px;
            border-radius: 4px; text-align: center; font-weight: bold;
            display: none; margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <!-- OVERLAY LOADER -->
    <div id="loader-overlay" class="loader">
        <i class="fas fa-spinner fa-spin"></i> Checking Records...
    </div>

    <!-- MAIN CARD -->
    <div class="card-container">

        <!-- FLOATING LOGO (CENTERED & BIG) -->
        <div class="floating-logo-container">
            <img src="https://raw.githubusercontent.com/Orbital-Skills/osi.com/main/LOGO.png" alt="OSD Logo">
        </div>

        <!-- TABS HEADER -->
        <div class="tabs-header">
            <!-- Left Tab: Gray -->
            <div class="tab tab-inactive" onclick="switchTab('qr')">
                <i class="fas fa-qrcode" style="margin-right: 8px;"></i> QR-Code Verification
            </div>
            <!-- Right Tab: Purple (Active) -->
            <div class="tab tab-active" onclick="switchTab('manual')">
                <i class="fas fa-file-alt" style="margin-right: 8px;"></i> Certificate Verification
            </div>
        </div>

        <!-- QR CONTENT (Hidden initially for demo purposes, based on screenshot showing Manual open) -->
        <div id="qr-tab" class="tab-content">
            <div class="form-area" style="text-align: center;">
                <h3 style="color:#555;">Scan QR Code</h3>
                <p>Use your camera to scan the QR code on the certificate.</p>
                <button class="verify-btn" style="background:#455a64;" onclick="alert('Camera requires HTTPS context.')">
                    <i class="fas fa-camera"></i> Open Scanner
                </button>
            </div>
        </div>

        <!-- MANUAL ENTRY CONTENT (Active) -->
        <div id="manual-tab" class="tab-content active">
            <div class="form-area">
                
                <div id="error-box" class="error-msg"></div>

                <div id="input-section">
                    <!-- Row 1: Roll No -->
                    <div class="input-group">
                        <label>Enter Roll / Registration No <span>*</span></label>
                        <input type="text" id="v-roll" placeholder="Ex: 2603001">
                    </div>

                    <!-- Row 2: Name & Father -->
                    <div class="row">
                        <div class="col input-group">
                            <label>Student Name</label>
                            <input type="text" id="v-name" placeholder="Full Name">
                        </div>
                        <div class="col input-group">
                            <label>Father's Name</label>
                            <input type="text" id="v-father" placeholder="Father Name">
                        </div>
                    </div>

                    <!-- Row 3: Mother & Course -->
                    <div class="row">
                        <div class="col input-group">
                            <label>Mother's Name</label>
                            <input type="text" id="v-mother" placeholder="Mother Name">
                        </div>
                        <div class="col input-group">
                            <label>Course Name</label>
                            <input type="text" id="v-course" placeholder="Applied Course">
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button class="verify-btn" onclick="verifyStudent()">
                        VERIFY RECORD <i class="fas fa-arrow-right" style="margin-left:5px;"></i>
                    </button>
                </div>

                <!-- RESULTS DISPLAY -->
                <div id="result-display" class="result-box">
                    <div class="success-badge">
                        <i class="fas fa-check-circle"></i> VERIFIED STUDENT RECORD
                    </div>
                    
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                        <img id="res-photo" src="" style="width: 100px; height: 120px; object-fit: cover; border: 3px solid #ddd; padding: 2px;">
                        
                        <table class="data-table">
                            <tr><td class="data-lbl">Roll No:</td><td class="data-val" id="res-roll"></td></tr>
                            <tr><td class="data-lbl">Name:</td><td class="data-val" id="res-name"></td></tr>
                            <tr><td class="data-lbl">Father Name:</td><td class="data-val" id="res-father"></td></tr>
                            <tr><td class="data-lbl">Course:</td><td class="data-val" id="res-course"></td></tr>
                            <tr><td class="data-lbl">Status:</td><td class="data-val" style="color:green;">PASS</td></tr>
                        </table>
                    </div>
                    
                    <button onclick="location.reload()" style="margin-top:20px; background:transparent; border:none; color: #6a1b9a; text-decoration: underline; cursor:pointer;">
                        Verify Another Student
                    </button>
                </div>

            </div>
        </div>

    </div>

    <!-- Script Logic -->
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby8NYb0IZguAp1nv56lMDokpQbiiCTkBz9IeYt66_aC3_YVnC9_4t6bXW9kK7aM_nZ_/exec"; 

        // Tabs Logic
        function switchTab(mode) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            // Remove active classes
            tabs[0].classList.remove('tab-active'); tabs[0].classList.add('tab-inactive');
            tabs[1].classList.remove('tab-active'); tabs[1].classList.add('tab-inactive');
            contents[0].classList.remove('active');
            contents[1].classList.remove('active');

            if(mode === 'qr') {
                tabs[0].classList.add('tab-active'); tabs[0].classList.remove('tab-inactive');
                contents[0].classList.add('active');
            } else {
                tabs[1].classList.add('tab-active'); tabs[1].classList.remove('tab-inactive');
                contents[1].classList.add('active');
            }
        }

        async function verifyStudent() {
            const roll = document.getElementById('v-roll').value.trim();
            const name = document.getElementById('v-name').value.trim();
            const father = document.getElementById('v-father').value.trim();
            const mother = document.getElementById('v-mother').value.trim();
            const course = document.getElementById('v-course').value.trim();
            
            const errBox = document.getElementById('error-box');
            errBox.style.display = 'none';

            if(!roll) {
                errBox.innerText = "Please Enter Roll Number or Registration No.";
                errBox.style.display = 'block';
                return;
            }

            document.getElementById('loader-overlay').style.display = 'block';

            try {
                // Sending POST request to Google Sheet App Script
                const response = await fetch(SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify({
                        Action: "VERIFY_STUDENT",
                        RollNo: roll,
                        Name: name,
                        FName: father,
                        MName: mother,
                        Course: course
                    })
                });

                const data = await response.json();
                document.getElementById('loader-overlay').style.display = 'none';

                if (data.Success) {
                    // Hide Form, Show Result
                    document.getElementById('input-section').style.display = 'none';
                    document.getElementById('result-display').style.display = 'block';

                    // Populate Data
                    document.getElementById('res-roll').innerText = data.Data.RollNo;
                    document.getElementById('res-name').innerText = data.Data.Name;
                    document.getElementById('res-father').innerText = data.Data.Father;
                    document.getElementById('res-course').innerText = data.Data.Course;
                    
                    if(data.Data.Photo) {
                        document.getElementById('res-photo').src = data.Data.Photo;
                    } else {
                        document.getElementById('res-photo').src = "https://via.placeholder.com/150?text=No+Img";
                    }

                } else {
                    let msg = "No Record Found for this Roll Number.";
                    if(data.Error === "MISMATCH") msg = "Record Found but Details (Name/Father) Mismatch.";
                    errBox.innerText = msg;
                    errBox.style.display = 'block';
                }

            } catch (error) {
                console.error(error);
                document.getElementById('loader-overlay').style.display = 'none';
                errBox.innerText = "Connection Failed. Please try again.";
                errBox.style.display = 'block';
            }
        }
        
        // Auto Load from URL ID
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            if(id) {
                document.getElementById('v-roll').value = id;
                verifyStudent();
            }
        };
    </script>

</body>
</html>
