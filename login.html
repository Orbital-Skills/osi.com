<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orbital Skill Development Center - Student Portal</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
*{font-family:'Inter',sans-serif}
.gradient-bg{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}
.fade-in{animation:fadeIn .4s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1}}
.toast{position:fixed;top:20px;right:20px;z-index:999}
</style>
</head>

<body class="gradient-bg min-h-screen">

<nav class="bg-white shadow p-4 flex justify-between">
  <h1 class="font-bold text-xl">Orbital Skill Development Center</h1>
  <div id="navActions"></div>
</nav>

<div id="app" class="container mx-auto p-6"></div>
<div id="toastContainer"></div>

<script>
/* ---------------- FIREBASE ---------------- */
firebase.initializeApp({
  apiKey:"AIzaSyCL_B52kVrkT54FMFmBANjkQrbN065g-KQ",
  authDomain:"orbital4u.firebaseapp.com",
  projectId:"orbital4u",
  storageBucket:"orbital4u.firebasestorage.app",
  messagingSenderId:"88284726348",
  appId:"1:88284726348:web:0d43de2919b592509b60e9"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* ---------------- STATE ---------------- */
let currentUser=null;

/* ---------------- UTILS ---------------- */
function showToast(msg,type="success"){
  const d=document.createElement("div");
  d.className=`toast px-4 py-2 rounded text-white ${type==="error"?"bg-red-500":"bg-green-500"}`;
  d.innerText=msg;
  toastContainer.appendChild(d);
  setTimeout(()=>d.remove(),3000);
}

/* ---------------- AUTH ---------------- */
async function loginStudent(e,p){
  await auth.signInWithEmailAndPassword(e,p);
}
async function logout(){
  await auth.signOut();
}

/* ---------------- RENDERS ---------------- */
function renderLogin(){
app.innerHTML=`
<div class="max-w-md mx-auto bg-white p-6 rounded">
<h2 class="text-2xl font-bold mb-4">Login</h2>
<form id="loginForm" class="space-y-3">
<input id="email" class="w-full border p-2" placeholder="Email">
<input id="password" type="password" class="w-full border p-2" placeholder="Password">
<button class="w-full bg-purple-600 text-white py-2">Login</button>
</form>
</div>`;
loginForm.onsubmit=e=>{
e.preventDefault();
loginStudent(email.value,password.value)
.catch(err=>showToast(err.message,"error"));
};
}

async function renderDashboard(){
const snap=await db.collection("students").doc(currentUser.uid).get();
const s=snap.data();

app.innerHTML=`
<div class="bg-white p-6 rounded shadow fade-in">

<h2 class="text-2xl font-bold mb-4">Dashboard</h2>

<div class="mb-6 p-4 bg-yellow-100 rounded" 
${s.profileStep1Completed&&s.profileStep2Completed&&s.profileStep3Completed?"hidden":""}>
‚ö†Ô∏è Complete profile to access courses
</div>

<div class="grid gap-4 md:grid-cols-3">

${!s.profileStep1Completed?`
<button onclick="renderProfileStep1()" class="bg-yellow-500 text-white p-3 rounded">
Complete Profile (Step 1)
</button>`:""}

${s.profileStep1Completed&&!s.profileStep2Completed?`
<button onclick="renderProfileStep2()" class="bg-orange-500 text-white p-3 rounded">
Complete Profile (Step 2)
</button>`:""}

${s.profileStep2Completed&&!s.profileStep3Completed?`
<button onclick="renderProfileStep3()" class="bg-indigo-500 text-white p-3 rounded">
Upload Documents (Step 3)
</button>`:""}

${s.profileStep1Completed&&s.profileStep2Completed&&s.profileStep3Completed?`
<button onclick="openCourses()" class="bg-blue-600 text-white p-3 rounded">
Course Materials
</button>`:""}

</div>
</div>`;
}

/* ---------------- STEP 1 ---------------- */
function renderProfileStep1(){
app.innerHTML=`
<div class="max-w-xl mx-auto bg-white p-6 rounded">
<h2 class="text-xl font-bold mb-4">Profile Step 1</h2>
<form id="s1" class="space-y-3">
<input id="father" class="w-full border p-2" placeholder="Father Name">
<input id="mother" class="w-full border p-2" placeholder="Mother Name">
<input id="dob" type="date" class="w-full border p-2">
<input id="qual" class="w-full border p-2" placeholder="Qualification">
<button class="bg-purple-600 text-white w-full py-2">Save</button>
</form>
</div>`;
s1.onsubmit=async e=>{
e.preventDefault();
await db.collection("students").doc(currentUser.uid).set({
fatherName:father.value,
motherName:mother.value,
dob:dob.value,
qualification:qual.value,
profileStep1Completed:true
},{merge:true});
showToast("Step 1 Done");
renderDashboard();
};
}

/* ---------------- STEP 2 ---------------- */
function renderProfileStep2(){
app.innerHTML=`
<div class="max-w-xl mx-auto bg-white p-6 rounded">
<h2 class="text-xl font-bold mb-4">Profile Step 2</h2>
<form id="s2" class="space-y-3">
<input id="aad" class="w-full border p-2" placeholder="Aadhar Number">
<input id="addr" class="w-full border p-2" placeholder="Address">
<select id="cat" class="w-full border p-2">
<option value="">Category</option>
<option>General</option><option>OBC</option><option>SC</option><option>ST</option>
</select>
<button class="bg-purple-600 text-white w-full py-2">Save</button>
</form>
</div>`;
s2.onsubmit=async e=>{
e.preventDefault();
await db.collection("students").doc(currentUser.uid).set({
aadharNumber:aad.value,
address:addr.value,
category:cat.value,
profileStep2Completed:true
},{merge:true});
showToast("Step 2 Done");
renderDashboard();
};
}

/* ---------------- STEP 3 ---------------- */
function renderProfileStep3(){
app.innerHTML=`
<div class="max-w-xl mx-auto bg-white p-6 rounded">
<h2 class="text-xl font-bold mb-4">Upload Documents</h2>
<button onclick="saveStep3()" class="bg-green-600 text-white w-full py-2">
Mark Documents Uploaded
</button>
</div>`;
}
async function saveStep3(){
await db.collection("students").doc(currentUser.uid).set({
profileStep3Completed:true,
profileCompleted:true
},{merge:true});
showToast("Profile Completed üéâ");
renderDashboard();
}

/* ---------------- COURSES ---------------- */
function openCourses(){
showToast("Redirecting to course...");
}

/* ---------------- NAV ---------------- */
function updateNav(){
navActions.innerHTML=currentUser?
`<button onclick="logout()" class="bg-red-500 text-white px-3 py-1 rounded">Logout</button>`:
`<button onclick="renderLogin()" class="bg-purple-600 text-white px-3 py-1 rounded">Login</button>`;
}

/* ---------------- INIT ---------------- */
auth.onAuthStateChanged(async u=>{
currentUser=u;
updateNav();
u?renderDashboard():renderLogin();
});
</script>

</body>
</html>
